[
  {
    "objectID": "daily_exercises/exercise_22.html",
    "href": "daily_exercises/exercise_22.html",
    "title": "Exercise 22: Forcast Modeling with Time Series Data",
    "section": "",
    "text": "# Load necessary libraries\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(dataRetrieval)\n\nWarning: package 'dataRetrieval' was built under R version 4.4.3\n\nlibrary(lubridate)\nlibrary(timetk)\n\nWarning: package 'timetk' was built under R version 4.4.3\n\nlibrary(modeltime)\n\nWarning: package 'modeltime' was built under R version 4.4.3\n\nlibrary(tidymodels)\n\n── Attaching packages ────────────────────────────────────── tidymodels 1.2.0 ──\n✔ broom        1.0.7     ✔ rsample      1.3.0\n✔ dials        1.3.0     ✔ tune         1.2.1\n✔ infer        1.0.7     ✔ workflows    1.1.4\n✔ modeldata    1.4.0     ✔ workflowsets 1.1.0\n✔ parsnip      1.2.1     ✔ yardstick    1.3.2\n✔ recipes      1.1.1     \n\n\nWarning: package 'recipes' was built under R version 4.4.3\n\n\nWarning: package 'rsample' was built under R version 4.4.3\n\n\n── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──\n✖ scales::discard() masks purrr::discard()\n✖ dplyr::filter()   masks stats::filter()\n✖ recipes::fixed()  masks stringr::fixed()\n✖ dplyr::lag()      masks stats::lag()\n✖ yardstick::spec() masks readr::spec()\n✖ recipes::step()   masks stats::step()\n• Use tidymodels_prefer() to resolve common conflicts.\n\nlibrary(prophet)\n\nWarning: package 'prophet' was built under R version 4.4.3\n\n\nLoading required package: Rcpp\n\nAttaching package: 'Rcpp'\n\nThe following object is masked from 'package:rsample':\n\n    populate\n\nLoading required package: rlang\n\n\nWarning: package 'rlang' was built under R version 4.4.3\n\n\n\nAttaching package: 'rlang'\n\nThe following objects are masked from 'package:purrr':\n\n    %@%, flatten, flatten_chr, flatten_dbl, flatten_int, flatten_lgl,\n    flatten_raw, invoke, splice\n\n# Data import for: Cache la Poudre River at Mouth (USGS site 06752260)\n\n# Bringing in historical (training) data (2013-2023)\npoudre_hist_flow &lt;- readNWISdv(siteNumber = \"06752260\",    # Download data from USGS for site 06752260\n                          parameterCd = \"00060\",      # Parameter code 00060 = discharge in cfs)\n                          startDate = \"2013-01-01\",   # Set the start date\n                          endDate = \"2023-12-31\") %&gt;% # Set the end date\n  renameNWISColumns() %&gt;%                             # Rename columns to standard names (e.g., \"Flow\", \"Date\")\n  mutate(date = floor_date(Date, \"month\")) %&gt;%        # Convert to first day of each month\n  group_by(date) %&gt;%                                  # Group the data by the new monthly Date\n  summarize(Flow = mean(Flow, na.rm = TRUE)) %&gt;%      # Calculate the monthly average flow\n  ungroup()\n\nGET:https://waterservices.usgs.gov/nwis/dv/?site=06752260&format=waterml%2C1.1&ParameterCd=00060&StatCd=00003&startDT=2013-01-01&endDT=2023-12-31\n\n# Bring in recent (testing) data (2024)\npoudre_2024_obs_flow &lt;- readNWISdv(siteNumber = \"06752260\",\n                          parameterCd = \"00060\",      \n                          startDate = \"2024-01-01\",  \n                          endDate = \"2024-12-31\") %&gt;% \n  renameNWISColumns() %&gt;%                              \n  mutate(date = floor_date(Date, \"month\")) %&gt;%        \n  group_by(date) %&gt;%                                 \n  summarize(Flow = mean(Flow, na.rm = TRUE)) %&gt;%     \n  ungroup()\n\nGET:https://waterservices.usgs.gov/nwis/dv/?site=06752260&format=waterml%2C1.1&ParameterCd=00060&StatCd=00003&startDT=2024-01-01&endDT=2024-12-31\n\n\n\n# Log normalization for training data\npoudre_hist_flow &lt;- poudre_hist_flow %&gt;% \n  mutate(log_flow = log1p(Flow))\n\n# Define forcasting models\n# Prophet model\nprophet_fit &lt;- prophet_reg() %&gt;% \n  set_engine(\"prophet\") %&gt;% \n  fit(log_flow ~ date, data = poudre_hist_flow)\n\nDisabling weekly seasonality. Run prophet with weekly.seasonality=TRUE to override this.\n\n\nDisabling daily seasonality. Run prophet with daily.seasonality=TRUE to override this.\n\n# ARIMA model\narima_fit &lt;- arima_reg() %&gt;% \n  set_engine(\"auto_arima\") %&gt;% \n  fit(log_flow ~ date, data = poudre_hist_flow)\n\nfrequency = 12 observations per 1 year\n\n# Combine models into modeltime table\nmodels_tbl &lt;- modeltime_table(prophet_fit, arima_fit)\n\n# Fortcast the next 12 months w/ test data\nfuture_dates &lt;- poudre_hist_flow %&gt;% \n  future_frame(.date_var = date, .length_out = 12)\n\nforcast_tbl &lt;- models_tbl %&gt;% \n  modeltime_forecast(\n    new_data = future_dates,\n    actual_data = poudre_hist_flow,\n    keep_data = TRUE\n  ) %&gt;% \n  mutate(.value = expm1(.value)) # Back-transform predictions to original scale\n  \n# Join predicted vs observed for 2024\ncomparison_tbl &lt;- forcast_tbl %&gt;% \n  filter(.key == \"prediction\") %&gt;% \n  select(.model_desc, .index, .value) %&gt;% \n  rename(\n    predicted = .value,\n    date = .index,\n    model_desc = .model_desc\n  ) %&gt;% \n  inner_join(poudre_2024_obs_flow, by = \"date\") %&gt;% \n  rename(observed = Flow) %&gt;% \n    mutate(model_desc = case_when(\n    str_detect(model_desc, \"ARIMA\") ~ \"ARIMA\",\n    str_detect(model_desc, \"PROPHET\") ~ \"Prophet\",\n    TRUE ~ model_desc))\n\n# Compute R-sq values\ncomparison_tbl %&gt;%  \n  group_by(model_desc) %&gt;% \n  summarize(r2 = summary(lm(observed ~ predicted))$r.squared)\n\n# A tibble: 2 × 2\n  model_desc    r2\n  &lt;chr&gt;      &lt;dbl&gt;\n1 ARIMA      0.922\n2 Prophet    0.880\n\n# Plot Predicted vs Observed Forcast Values\nggplot(comparison_tbl, aes(x = predicted, y = observed, color = model_desc)) +\n  geom_point(size = 2) +\n  geom_smooth(method = \"lm\", se = FALSE, linetype = \"solid\") +\n  geom_abline(slope = 1, intercept = 0, linetype = \"dashed\", color = \"black\") +\n  labs(\n    title = \"Forcast (Predicted) vs Observed Monthly Flow for 2024\",\n    subtitle = \"Model comparison using ARIMA and Prophet\",\n    x = \"Predicted Flow (cfs)\",\n    y = \"Observed Flow (cfs)\",\n    color = \"Model\"\n  ) +\n  theme_minimal() +\n  theme(legend.position =  \"top\",\n        plot.title = element_text(hjust = 0.5),  # Center title\n    plot.subtitle = element_text(hjust = 0.5)  # Center\n    ) +\n  coord_fixed(ratio = 1) +   # Ensures 1:1 aspect ratio\n  coord_cartesian(xlim= c(0, 600), ylim = c(0,600)) # Fix axis scales\n\nCoordinate system already present. Adding new coordinate system, which will\nreplace the existing one.\n\n\n`geom_smooth()` using formula = 'y ~ x'"
  },
  {
    "objectID": "labs/lab_overview.html",
    "href": "labs/lab_overview.html",
    "title": "Lab Overview",
    "section": "",
    "text": "Overview of Labs\nThis document provides a summary for each lab file.\n\n\nLabs\n\nLab 01\n\nIn this lab we built personal websites using github pages. The linked file connects to the github repo for the personal site.\n\nLab 02\n\nIn this lab we began to explore data maniplation in R.\n\nLab 03\n\nIn this lab we used the NY-Times COVID-19 dataset to practice data manipulation, vizualization and EDA.\n\nLab 04\n\nIn this lab we used the LTER dataset to practice statistical analysis using R.\n\nLab 05\n\nIn this lab my group explored some potential project topics for the course project.\n\nLab 06\n\nIn this lab we practiced building machine learning models using the CAMELS hyrological dataset.\n\nLab 07\n\nIn this lab my group outlined our course project with an abstract and exploratory data analysis (EDA).\n\nLab 08\n\nIn this lab we practiced tuning the best machine learning model from Lab 06 using the CAMELS hyrological dataset.\n\nLab 09\n\nIn this lab my group completed the modeling for our project and vizualized the results.\n\nLab 10\n\nIn this lab we work with spatial data, exploring the distance form borders in colorado and nationally."
  }
]